#####
# Decluttering templates
# https://github.com/custom-cards/decluttering-card
#####

header:
  card:
    style: >
      ha-card {
        height: 100%;
        background: none;
        font-family: var(--paper-ha-card_-_font-family);
        font-weight: 700;
        font-size: 3em;
        line-height: 1em;
        color: var(--el-title-color);
        margin-left: -15px;
      }
    type: markdown
    content: |
      [[content]]
  default: null

subheader:
  card:
    style: >
      ha-card {
        height: 100%;
        background: none;
        font-family: var(--paper-ha-card_-_font-family);
        font-weight: 700;
        font-size: 2em;
        line-height: 1em;
        color: var(--el-title-color);
        margin-left: -15px;
        margin-top: -20px;
        margin-bottom: -20px;
      }
    type: markdown
    content: |
      [[content]]
  default: null

title:
  card:
    card_mod:
      style: >
        ha-card {
          height: 100%;
          background: none;
          font-family: var(--paper-ha-card_-_font-family);
          font-weight: 700;
          font-size: 24px;
          color: var([[color]]);
          margin-left: -15px;
          margin-top: -20px;
          margin-bottom: -15px;
        }
    type: markdown
    content: |
      [[content]]
  default:
    - color: --el-title-color

subtitle:
  card:
    card_mod:
      style: >
        ha-card {
          height: 100%;
          background: none;
          font-family: var(--paper-ha-card_-_font-family);
          font-weight: 600;
          font-size: 17px;
          color: var(--[[color]]);
          margin-left: -15px;
          margin-top: -25px;
          margin-bottom: -15px;
        }
    type: markdown
    content: |
      [[content]]
  default:
    - color: --el-title-color

subsubtitle:
  card:
    card_mod:
      style: >
        ha-card {
          height: 100%;
          background: none;
          font-family: var(--paper-ha-card_-_font-family);
          font-weight: 600;
          font-size: 14px;
          color: var(--[[color]]);
          margin-bottom: -6px;
          margin-top: 12px;
        }
        ha-markdown {
          padding: 0 !important;
        }
    type: markdown
    content: |
      [[content]]
  default:
    - color: --el-title-color

device:
  card:
    card_mod:
      style: >
        ha-card {
          height: 100%;
          background: none;
          font-weight: 700;
          font-size: 13px;
          color: var(--el-title-color);
          text-align: center;
          position: static;
          margin-top: -20px;
          margin-bottom: -25px;
        }
    type: markdown
    content: |
      [[content]]
  default: null

section-header:
  card:
    name: "[[name]]"
    show_icon: false
    show_state: false
    show_name: true
    action: none
    tap_action:
      action: none
    hold_action:
      action: none
    double_tap_action:
      action: none
    variables:
      sensor_entity: "[[sensor_entity]]"
      is_small: "[[is_small]]"
    triggers_update:
      - "[[sensor_entity]]"
    styles:
      card:
        - background: transparent
        - border-radius: 0px
        - color: var(--el-title-color)
        - font-family: var(--paper-ha-card_-_font-family)
        - margin-bottom: >
            [[[
              return variables["is_small"] ? "0px" :  "16px";
            ]]]
        - padding: 0
        - --button-card-ripple-press-opacity: 0
        - -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        - -webkit-focus-ring-color: rgba(0, 0, 0, 0);
        - outline: none !important;
        - pointer-events: none
      grid:
        - grid-template-areas: '"n actions" "subtitle actions"'
        - grid-template-columns: 1fr min-content
        - grid-template-rows: min-content min-content
      name:
        - place-self: flex-start
        - font-weight: 700
        - font-size: >
            [[[
              return variables["is_small"] ? "18px" :  "24px";
            ]]]
        - margin-bottom: 4px
      custom_fields:
        subtitle:
          - place-self: flex-start
          - font-weight: 700
          - font-size: 16px
    custom_fields:
      subtitle: >
        [[[ 
          if(variables.is_small) {
            return
          }
          if (states[variables.sensor_entity].state == "0") {
            return "NÃ£o existem luzes ligadas.";
          } else if (states[variables.sensor_entity].state == "1") {
            return states[variables.sensor_entity].state + " luz ligada.";
          } else {
            return states[variables.sensor_entity].state + " luzes ligadas.";
          }
        ]]]
      actions:
        card:
          type: conditional
          conditions:
            - entity: "[[sensor_entity]]"
              state_not: "0"
          card:
            type: "custom:decluttering-card"
            template: script-round-button
            variables:
              - entity: "[[sensor_entity]]"
              - template: script-turn-off
              - script: "[[script]]"
              - height: >
                  [[[
                    return variables["is_small"] ? "25px" :  "50px";
                  ]]]
    type: "custom:button-card"
  default:
    - is_small: false

banner:
  card:
    type: "custom:button-card"
    name: "[[content]]"
    entity: "[[entity]]"
    show_icon: true
    show_state: false
    show_name: true
    icon: "[[icon]]"
    styles:
      card:
        - background: var(--ha-card-background-alert)
        - font-size: 14px
        - font-weight: bold
        - padding: 4px 12px
      grid:
        - grid-template-areas: "'i n'"
        - grid-template-rows: 1fr
        - grid-template-columns: min-content 1fr
      img_cell:
        - margin-right: 5px
        - width: 15px
        - padding-bottom: 1px
      icon:
        - width: 100%
      name:
        - place-self: flex-start
  default: null

#---------------------#
# Entity state cards
#---------------------#
es-icon:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: false
    show_name: false
    styles: !include ../styles/style-icon.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default: null

es:
  card:
    custom_fields: !include ../circles/circle-x.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    hold_action: !include ../holds/hold-action-es.yaml
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"

# Shows if a person is at home or not
es-person:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: true
    tap_action:
      action: none
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-person.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --purple-gradient, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"

# Shows the state of a configuration
es-config:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: false
    tap_action:
      action: "[[action]]"
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-small.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - action: toggle
    - background-on: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - card-height: 50px
    - grid-gap: 0
    - grid-template-rows: 1.1fr 1fr
    - text-align-name: left
    - align-self-name: end
    - align-self-state: start
    - margin-name: 0 0 3px 0

# Configurations using input_number
es-config-number:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_units: true
    show_state: true
    tap_action:
      action: more-info
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-number-set.yaml
    custom_fields:
      description: >
        [[[
          return `<span>${variables.description}</span>`
        ]]]
      down:
        card:
          type: "custom:button-card"
          aspect_ratio: 1/1
          icon: mdi:chevron-down
          size: 40%
          color: var(--el-text-color-light)
          styles:
            card:
              - background: var(--ha-card-background-es-static)
              - border-radius: 50%
          tap_action:
            action: call-service
            service: input_number.decrement
            data:
              entity_id: "[[entity]]"
      up:
        card:
          type: "custom:button-card"
          aspect_ratio: 1/1
          icon: mdi:chevron-up
          size: 40%
          color: var(--el-text-color-light)
          styles:
            card:
              - background: var(--ha-card-background-es-static)
              - border-radius: 50%
          tap_action:
            action: call-service
            service: input_number.increment
            data:
              entity_id: "[[entity]]"
    variables:
      description: "[[description]]"
    type: "custom:button-card"
  default:
    - icon-size: 35px

es-dummy:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: true
    tap_action:
      action: none
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-centered.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"

es-light:
  card:
    custom_fields: !include ../circles/pill-x.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    hold_action:
      action: more-info
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-empty.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --yellow-gradient, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - info-attribute: entity.attributes.brightness
    - info-max: (254 / 100)
    - info-unit: "%"
    - info-state: "on"

# Lights which support speed and itensity as WLED. Changes in hold action.
es-light-wled:
  card:
    custom_fields: !include ../circles/pill-x.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    hold_action: !include ../holds/hold-action-es-lights-wled.yaml
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-empty.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --yellow-gradient, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - info-attribute: entity.attributes.brightness
    - info-max: (254 / 100)
    - info-unit: "%"
    - info-state: "on"

# Lights which only support white range of values as Tasmota. Changes in hold action.
es-light-tasmota:
  card:
    custom_fields: !include ../circles/pill-x.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    hold_action: !include ../holds/hold-action-es-lights-tasmota.yaml
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-empty.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --yellow-gradient, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - info-attribute: entity.attributes.brightness
    - info-max: (254 / 100)
    - info-unit: "%"
    - info-state: "on"

# Lights which only support color temperatures
es-light-temperature:
  card:
    custom_fields: !include ../circles/pill-x.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    hold_action: !include ../holds/hold-action-es-lights-temperature.yaml
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-empty.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --yellow-gradient, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - info-attribute: entity.attributes.brightness
    - info-max: (254 / 100)
    - info-unit: "%"
    - info-state: "on"

# Lights which toggle based on a switch and colors are controlled from another entity
es-light-switch:
  card:
    custom_fields: !include ../circles/pill-x.yaml
    entity: "[[entity-switch]]"
    name: "[[name]]"
    hold_action: !include ../holds/hold-action-es-lights-temperature.yaml
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-empty.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --yellow-gradient, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - info-attribute: entity.attributes.brightness
    - info-max: (254 / 100)
    - info-unit: "%"
    - info-state: "on"

# Lights which toggle based on a switch and colors are controlled from another entity.
# Hold action controls each individual light connected to switch
es-light-switch-2:
  card:
    custom_fields: !include ../circles/pill-x.yaml
    entity: "[[entity-switch]]"
    name: "[[name]]"
    hold_action:
      action: more-info
      entity: "[[entity]]"
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-empty.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --yellow-gradient, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - info-attribute: entity.attributes.brightness
    - info-max: (254 / 100)
    - info-unit: "%"
    - info-state: "on"

# Lights with a slider
es-light-slider:
  card:
    custom_fields: !include ../cards/card-light-slider.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    #hold_action: !include ../holds/hold-action-es-lights.yaml
    tap_action:
      action: toggle
    show_icon: false
    show_state: false
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-slider.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"

# Wall plug devices
es-switch:
  card:
    custom_fields: !include ../circles/pill-x.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-empty.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
    variables:
      power_entity: "[[entity-power]]"
  default:
    - background-on: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - info-attribute: false
    - info-max: 1
    - info-unit: "W"
    - info-state: "on"

es-switch-confirmation:
  card:
    custom_fields: !include ../circles/pill-x.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
    confirmation:
      text: "[[confirmation-text]]"
    variables:
      power_entity: "[[entity-power]]"
  default:
    - background-on: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - info-attribute: false
    - info-max: 1
    - info-unit: "W"
    - info-state: "on"

es-switch-energy:
  card:
    custom_fields:
      graph:
        card:
          type: custom:mini-graph-card
          entities:
            - sensor.plug_3_power
          hours_to_show: 24
          line_width: 3
          lower_bound: 15
          show:
            icon: false
            name: false
            state: false
            average: true
            extrema: true
            labels: false
            fill: true
          card_mod:
            style: >
              ha-card {
                background: transparent;
                border-radius: 0 var(--ha-card-border-radius) var(--ha-card-border-radius) 0;
                padding-top: 0 !important;
              }
              ha-card[fill] .info { padding-bottom: 15px !important; }
              ha-card > div.info {
                padding: 0 10px 5px;
              }
              .info__item__type { font-size: 12px; }
              .info__item__time { font-size: 9px; }
              .info__item__value { font-size: 12px; }
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-energy-detail.yaml
    template: "[[template]]"
    type: "custom:button-card"
    confirmation:
      text: "[[confirmation-text]]"
    variables:
      power_entity: "[[entity-power]]"
  default:
    - background-on: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - info-attribute: false
    - info-max: 1
    - info-unit: "W"
    - info-state: "on"

# Small card for boolean config switches
es-boolean:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: toggle
    show_icon: false
    show_state: true
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-sensor-script.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"

# Devices state obtained with ping integration
es-ping:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: none
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-ping.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --green-tint, var(--ha-card-background-es-on)
    - background-default: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"

# Covers
es-cover:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    hold_action:
      action: more-info
    tap_action:
      action: call-service
      service: "[[toggle-script]]"
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-empty.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    #- background-on: --ha-card-background-es-on
    - background-on: --pink-gradient
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "open"
    - state-2: "closed"
    - state-3: "closing"
    - info-attribute: entity.attributes.current_position
    - info-max: 1
    - info-unit: "%"
    - info-state: "open"

es-speaker:
  card:
    custom_fields: !include ../circles/circle-x.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action: !include ../holds/hold-action-es-speaker.yaml
    show_icon: false
    show_state: true
    state: !include ../states/state-es-speaker.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default: null

es-tv:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action: !include ../holds/hold-action-es-tv.yaml
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-empty.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --red-gradient, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"
    - state-4: "unavailable"

es-camera:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: more-info
    show_icon: false
    show_state: true
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: detected
    - state-2: idle
    - state-3: recording

es-mood:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: call-service
      service: input_select.select_option
      data:
        entity_id: "[[entity]]"
        option: "[[option]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-mood.yaml
    styles: !include ../styles/style-card-centered-outline.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default: null

es-number:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: none
    show_icon: false
    show_state: true
    styles: !include ../styles/style-card-number.yaml
    template: "[[template]]"
    type: "custom:button-card"
    default: null

#---------------------#
# Path cards
#---------------------#

# Navigation card
path:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: navigate
      navigation_path: "[[path]]"
    show_icon: false
    show_state: false
    styles: !include ../styles/style-card-path.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default: null

# Navigation card for divisions
path-division:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: navigate
      navigation_path: "[[path]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-path-division.yaml
    styles: !include ../styles/style-card-path-division.yaml
    extra_styles: |
      .pill {
        align-items: center;
        background: var(--ha-card-background-es-off);
        border-radius: 30px;
        display: flex;
        padding: 1px 5px;
      }
    custom_fields:
      scripts:
        card:
          type: "custom:decluttering-card"
          template: script-round-button
          variables:
            - template: script-turn-off
            - script: "[[script]]"
            - border-radius: 12px
            - height: 45px
            - width: 45px
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - rows-on: 1.2fr min-content min-content
    - rows-off: 1.5fr 1fr

# Navigation card for car
path-car:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: navigate
      navigation_path: "[[navigation_path]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-car-lock.yaml
    styles: !include ../styles/style-card-path-car.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default: null

#---------------------#
# Scene, Scripts cards
#---------------------#

scene:
  card:
    entity: "[[scene]]"
    name: "[[name]]"
    tap_action:
      action: call-service
      service: scene.turn_on
      data:
        entity_id: "[[scene]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-btn.yaml
    styles: !include ../styles/style-card-scene.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - name: "[[[ return entity.attributes.friendly_name ]]]"

button:
  card:
    entity: "[[script]]"
    name: "[[name]]"
    tap_action:
      action: call-service
      service: button.press
      data:
        entity_id: "[[script]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-btn.yaml
    styles: !include ../styles/style-card-centered.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - name: "[[[ return entity.attributes.friendly_name ]]]"

script:
  card:
    entity: "[[script]]"
    name: "[[name]]"
    tap_action:
      action: call-service
      service: script.turn_on
      data:
        entity_id: "[[script]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-btn.yaml
    styles: !include ../styles/style-card-centered.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - name: "[[[ return entity.attributes.friendly_name ]]]"

# Shows same look and feel as scene but is a script
script-as-scene:
  card:
    entity: "[[script]]"
    name: "[[name]]"
    tap_action:
      action: call-service
      service: script.turn_on
      data:
        entity_id: "[[script]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-btn.yaml
    styles: !include ../styles/style-card-scene.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - name: "[[[ return entity.attributes.friendly_name ]]]"

# Shows the state of an script executor with sensor state
script-sensor:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: call-service
      service: script.turn_on
      data:
        entity_id: "[[script]]"
    show_icon: false
    show_state: true
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-sensor-script.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --ha-card-background-es-on
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-1: "on"
    - state-2: "off"

script-button:
  card:
    entity: "[[script]]"
    tap_action:
      action: call-service
      service: script.turn_on
      service_data:
        entity_id: "[[script]]"
    show_icon: false
    show_name: false
    show_state: false
    state: !include ../states/state-script.yaml
    styles: !include ../styles/style-card-path-button.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default: null

script-round-button:
  card:
    entity: "[[script]]"
    tap_action:
      action: call-service
      service: script.turn_on
      service_data:
        entity_id: "[[script]]"
    show_icon: false
    show_name: false
    show_state: false
    variables:
      border-radius: "[[border-radius]]"
      height: "[[height]]"
      width: "[[width]]"
    state: !include ../states/state-script.yaml
    styles: !include ../styles/style-card-round.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - height: 50px
    - width: 70px
    - border-radius: 30px

script-timer-time-button:
  card:
    name: "[[name]]"
    entity: "[[entity]]"
    tap_action:
      action: call-service
      service: timer.start
      service_data:
        entity_id: "[[entity]]"
        duration: "[[duration]]"
    show_icon: false
    show_name: true
    show_state: false
    variables:
      border-radius: "[[border-radius]]"
      height: "[[height]]"
      width: "[[width]]"
    styles:
      card:
        - background: var(--contrast5)
        - border-radius: var(--border-radius)
        - color: var(--ha-card-color-name-off)
        - font-size: 12px
        - font-weight: bold
        - height: var(--height)
        - width: var(--width)
        - padding: 3px 2px 2px 2px
        - pointer-events: initial
        - --height: "[[height]]"
        - --width: "[[width]]"
        - --border-radius: "[[border-radius]]"
    type: "custom:button-card"
  default:
    - height: 25px
    - width: 60px
    - border-radius: 30px

script-timer-cancel-button:
  card:
    entity: "[[entity]]"
    icon: mdi:stop
    tap_action:
      action: call-service
      service: timer.cancel
      service_data:
        entity_id: "[[entity]]"
    show_icon: true
    show_name: false
    show_state: false
    styles:
      card:
        - background: none
        - height: 25px
        - width: 25px
        - padding: 3px 2px 2px 2px
        - pointer-events: initial
      icon:
        - color: var(--ha-card-color-state-on)
        - width: 100%
    type: "custom:button-card"
  default: null

script-mood-outline:
  card:
    entity: "[[script]]"
    name: "[[name]]"
    tap_action:
      action: call-service
      service: script.turn_on
      data:
        entity_id: "[[script]]"
    show_icon: false
    show_state: false
    styles: !include ../styles/style-card-centered-outline.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default: null

#---------------------#
# Sensor cards
#---------------------#
sensor-pill:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    icon: "[[icon]]"
    show_icon: true
    show_state: true
    show_name: "[[show-name]]"
    show_units: "[[show-units]]"
    numeric_precision: "[[numeric_precision]]"
    tap_action:
      action: more-info
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-sensor-pill.yaml
    #template: "[[template]]"
    type: "custom:button-card"
    variables:
      show-name: "[[show-name]]"
      show-overflow: "[[show-overflow]]"
  default:
    - background-on: --ha-card-background-es-on
    - background-default: --orange-tint, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - numeric_precision: 1
    - state-1: "on"
    - state-2: "off"
    - show-name: false
    - show-overflow: false
    - show-units: true

sensor-energy:
  card:
    name: "[[name]]"
    entity: "[[entity]]"
    show_icon: false
    show_state: false
    #tap_action:
    #  action: none
    styles: !include ../styles/style-card-energy.yaml
    template: "[[template]]"
    type: "custom:button-card"
    variables:
      bill_entity: "[[entity-bill]]"
      bill_entity_old: "[[entity-bill-old]]"
    card_mod:
      style: |-
        #sd3:empty {
          display: none;
        }
  default:
    - entity-bill-old: ""

sensor-climate-temp:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: false
    show_name: "[[show_name]]"
    tap_action:
      action: more-info
    styles: !include ../styles/style-card-climate-state.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - template: sensors-climate-temp
    - height: 40px
    - show_name: false
    - name: ""

sensor-climate-humidity:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: false
    show_name: "[[show_name]]"
    tap_action:
      action: more-info
    styles: !include ../styles/style-card-climate-state.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - template: sensors-climate-humidity
    - height: 40px
    - show_name: false
    - name: ""

sensor-number:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: true
    show_units: "[[show_units]]"
    numeric_precision: 0
    variables:
      unit: "[[unit]]"
      numeric_precision: "[[numeric_precision]]"
      background_morning: "[[background_morning]]"
      background_afternoon: "[[background_afternoon]]"
    state_display: >
      [[[
        if (entity && entity.state === 'unknown' || entity.state === undefined)
          return "-";
        else
          if ([[localize]]) {
            return helpers.localize(entity, undefined, undefined, [[show_units]], variables.unit);
          } else {
            return entity.state + variables.unit;
          }
      ]]]
    styles: !include ../styles/style-card-number.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background: var(--ha-card-background-es-static)
    - color: var(--el-es-static-text-color)
    - font_name: 12px
    - font_state: 28px
    - height: 90px
    - padding_bottom: 10px
    - show_units: true
    - numeric_precision: undefined
    - localize: true
    - unit: undefined

sensor-number-ext:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: url
      url_path: "[[url-1]]"
    show_icon: false
    show_state: true
    state_display: >
      [[[
        if (entity.state === 'unknown' || entity.state === undefined)
          return "-";
        else
          return helpers.localize(entity);
      ]]]
    styles: !include ../styles/style-card-number.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background: var(--ha-card-background-es-static)
    - color: var(--el-es-static-text-color)
    - font_name: 12px
    - font_state: 28px
    - height: 90px
    - padding_bottom: 10px

sensor-number-local:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: navigate
      navigation_path: "[[url-1]]"
    show_icon: false
    show_state: true
    state_display: >
      [[[
        if (entity.state === 'unknown' || entity.state === undefined)
          return "-";
        else
          return helpers.localize(entity);
      ]]]
    state: !include ../states/state-es-number.yaml
    styles: !include ../styles/style-card-number.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background: var(--ha-card-background-es-static)
    - color: var(--el-es-static-text-color)
    - font_name: 14px
    - font_state: 28px
    - height: 90px
    - padding_bottom: 5px

sensor-number-image:
  card:
    type: "custom:button-card"
    name: "[[name]]"
    entity: "[[entity]]"
    show_icon: false
    show_state: true
    show_units: "[[show_units]]"
    variables:
      image-url: "[[image-url]]"
    state_display: >
      [[[
        if (entity && entity.state === 'unknown' || entity.state === undefined)
          return "-";
        else
          return helpers.localize(entity, undefined, undefined, [[show_units]]);
      ]]]
    styles: !include ../styles/style-card-number.yaml
    template: "[[template]]"
    custom_fields:
      image:
        card:
          type: picture
          image: "[[image-url]]"
          card_mod:
            style: |
              ha-card.type-picture {
                background: transparent;
                border-radius: var(--ha-card-border-radius) var(--ha-card-border-radius) 0 0 !important;
                height: 40px;
                position: relative;
              }
              ha-card.type-picture:before {
                content: ' ';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                box-shadow: 0 0 100px rgba(0,0,0,0.3) inset;
              }

  default:
    - background: var(--ha-card-background-es-static)
    - color: var(--el-es-static-text-color)
    - font_name: 12px
    - font_state: 28px
    - height: 90px
    - padding_bottom: 10px
    - show_units: true

sensor-number-gauge:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: false
    show_units: "[[show_units]]"
    styles: !include ../styles/style-card-number.yaml
    template: "[[template]]"
    type: "custom:button-card"
    custom_fields: !include ../graphs/gauge-x.yaml
  default:
    - background: var(--ha-card-background-es-static)
    - color: var(--el-es-static-text-color)
    - font_name: 12px
    - height: auto
    - show_units: true
    - padding_bottom: 0px

sensor-bill:
  card:
    entity: "[[entity]]"
    show_name: false
    show_icon: false
    show_state: false
    styles: !include ../styles/style-card-bill.yaml
    template: "[[template]]"
    type: "custom:button-card"
    variables:
      type: "[[type]]"
      title: "[[title]]"
      company: "[[company]]"
    card_mod:
      style: |-
        ha-card.type-custom-apexcharts-card {
          background: transparent;
        }
        .pill {
          border-radius: 20px;
          display:flex;
          height:20px;
          font-size: 13px;
          padding: 2px 12px 0px 12px;
        }
        .pill:nth-of-type(1) {
          background:var(--contrast4);
          justify-self: left;
        }
        .pill:nth-of-type(2) {
          background:var(--contrast5);
          justify-self: center;
        }
        .pill:nth-of-type(3) {
          background:var(--ha-card-background-es-on);
          justify-self: right;
        }
        .pill.not-valid:nth-of-type(3) {
          background:var(--contrast6);
          justify-self: right;
        }
  default: null

sensor-internet:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: none
    show_icon: false
    show_state: false
    #state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card-internet.yaml
    template: "[[template]]"
    custom_fields: !include ../sensors/sensors-internet.yaml
    type: "custom:button-card"

#---------------------#
# Radio cards
#---------------------#

radio:
  card:
    name: "[[radio]]"
    tap_action:
      action: call-service
      service: script.radio_set
      data:
        chromecast_radio_option: "[[room]]"
        radio_station_option: "[[radio]]"
    show_icon: false
    show_state: false
    styles: !include ../styles/style-card-centered.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default: null

#---------------------#
# Buttons
#---------------------#

btn:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: "[[action]]"
      service: "[[service]]"
      data:
        entity_id: "[[entity]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-btn.yaml
    styles: !include ../styles/style-card-centered.yaml
    variables:
      show_type: "[[show_type]]"
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - action: call-service
    - name: "[[[ return entity.attributes.friendly_name ]]]"
    - show_type: false

btn-small:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: "[[action]]"
      service: "[[service]]"
      data:
        entity_id: "[[entity]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-btn.yaml
    styles: !include ../styles/style-card-small.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - action: call-service
    - name: "[[[ return entity.attributes.friendly_name ]]]"
    - card-height: 60px
    - grid-gap: 0
    - grid-template-rows: 1fr min-content min-content min-content
    - text-align-name: center
    - align-self-name: center
    - align-self-state: center
    - margin-name: 0

btn-confirmation:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: "[[action]]"
      service: "[[service]]"
      data:
        entity_id: "[[entity]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-btn.yaml
    styles: !include ../styles/style-card-centered.yaml
    confirmation:
      text: "[[confirmation-text]]"
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - action: call-service
    - confirmation-text: "De certeza?"
    - name: "[[[ return entity.attributes.friendly_name ]]]"

btn-small-confirmation:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: "[[action]]"
      service: "[[service]]"
      data:
        entity_id: "[[entity]]"
    show_icon: false
    show_state: false
    state: !include ../states/state-btn.yaml
    styles: !include ../styles/style-card-small.yaml
    confirmation:
      text: "[[confirmation-text]]"
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - action: call-service
    - confirmation-text: "De certeza?"
    - name: "[[[ return entity.attributes.friendly_name ]]]"
    - card-height: 60px
    - grid-gap: 0
    - grid-template-rows: 1fr min-content min-content min-content
    - text-align-name: center
    - align-self-name: center
    - align-self-state: center
    - margin-name: 0

btn-icon-text:
  card:
    type: "custom:button-card"
    entity: "[[entity]]"
    icon: "mdi:[[icon]]"
    name: "[[name]]"
    tap_action: "[[tap_action]]"
    styles: !include ../styles/style-btn-icon.yaml

btn-moods:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action: !include ../holds/hold-action-mood.yaml
    show_icon: false
    show_state: true
    state: !include ../states/state-es-script.yaml
    styles: !include ../styles/style-card-centered.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default: null

#---------------------#
# Map
#---------------------#
map-card:
  card:
    type: custom:vertical-stack-in-card
    cards:
      - type: markdown
        content: "QuilÃ³metros"
        card_mod:
          style: |
            ha-card.type-markdown {
              background: transparent;
              height: 0px;
            }
            ha-markdown {
              bottom: -80px;
              color: var(--el-text-color);
              font-size: 12px;
              font-weight: bold;
              left: 0px;
              padding-left: 10px !important;
              padding-top: 0px !important;
              position: absolute;
              z-index: 1;
            }
      - type: markdown
        content: |
          {{ states.sensor.my_id_odometer.state }} KMs
        card_mod:
          style: |
            ha-card.type-markdown {
              background: transparent;
              height: 0px;
            }
            ha-markdown {
              bottom: -96px;
              color: var(--el-text-color);
              font-size: 12px;
              left: 0px;
              padding-left: 10px !important;
              padding-top: 0px !important;
              position: absolute;
              z-index: 1;
            }
      - type: picture-entity
        entity: camera.vw_ev_location
        show_name: false
        show_state: false
        tap_action:
          action: none
        card_mod:
          style: |
            ha-card {
              border-radius: 0px;
              margin-bottom: -20px;
              margin-top: -5x;
            }
            img {
              position: relative;
            }
            .type-picture-entity:after {
              background: linear-gradient(to bottom, var(--map-gradient-end) 5px, rgba(0, 0, 0, 0) 15%),
                          linear-gradient(to right, var(--map-gradient-end) 5px, rgba(0, 0, 0, 0) 40%),
                          linear-gradient(to left, var(--map-gradient-end) 0px, rgba(0, 0, 0, 0) 15%),
                          linear-gradient(to top, var(--map-gradient-end) 15px, rgba(0, 0, 0, 0) 20%);
              content: '';
              height: 100%;
              left:0;
              position: absolute;
              top: 0;
              width: 100%;
            }

#---------------------#
# Timer
#---------------------#

timer-ac:
  card:
    entity: "[[entity]]"
    name: "[[name]]"
    tap_action:
      action: more-info
    show_icon: false
    show_state: false
    show_name: false
    #state_display: !include ../helpers/state_display-ac.yaml
    state:
      - styles:
          card:
            - background: var(--pink-gradient)
            - height: 45px
          grid:
            - grid-template-areas: '"icon_hue timer script-1 script-2 script-3"'
            - grid-template-rows: 1fr
          custom_fields:
            timer:
              - font-size: 13px
              - padding-bottom: 0
            description:
              - display: none
            script-cancel:
              - display: none
        value: "idle"
    styles: !include ../styles/style-card-timer.yaml
    template: "[[template]]"
    type: "custom:button-card"
    custom_fields: !include ../icons/ac-timer.yaml

#---------------------#
# Climate
#---------------------#

climate-ac:
  card:
    custom_fields: !include ../circles/pill-x.yaml
    entity: "[[entity]]"
    name: "[[name]]"
    #hold_action: !include ../holds/hold-action-es-lights.yaml
    tap_action:
      action: more-info
    show_icon: false
    show_state: true
    state_display: !include ../helpers/state_display-ac.yaml
    state: !include ../states/state-x.yaml
    styles: !include ../styles/style-card.yaml
    template: "[[template]]"
    type: "custom:button-card"
  default:
    - background-on: --pink-gradient, var(--ha-card-background-es-on)
    - color-name-on: --ha-card-color-name-on
    - color-name-off: --ha-card-color-name-off
    - color-state-on: --ha-card-color-state-on
    - color-state-off: --ha-card-color-state-off
    - state-2: "off"
    - state-5: "^(cool|dry|fan_only|heat|auto)$"
    - info-attribute: entity.attributes.temperature
    - info-state: "on"

climate-vw:
  card:
    type: custom:vertical-stack-in-card
    cards:
      - type: "custom:button-card"
        entity: "[[entity-climate]]"
        name: "[[name]]"
        show_icon: false
        show_state: true
        tap_action:
          action: none
        styles: !include ../styles/style-card-climate.yaml
        template: "[[template]]"
        variables:
          current_temp: >
            [[[
              if(entity.state == "off") {
                if(states['[[entity-climate]]'].attributes.temperature == undefined || states['[[entity-climate]]'].state == 'unavailable') { return -1 }
                else { return `${states['[[entity-climate]]'].attributes.temperature}`; }
              } else {
                if(states['[[entity-climate]]'].attributes.current_temperature == undefined || states['[[entity-climate]]'].state == 'unavailable') { return -1 }
                else { return `${states['[[entity-climate]]'].attributes.current_temperature}`; }
              }

              if(states['[[entity-climate]]'].attributes.current_temperature == undefined || states['[[entity-climate]]'].state == 'unavailable') { return -1 }
              else { return `${states['[[entity-climate]]'].attributes.current_temperature}`; }
            ]]]
          target_temp: >
            [[[
              if(states['[[entity-climate-goal]]'].state == undefined || states['[[entity-climate-goal]]'].state == 'unavailable') { return -1 }
              else { return `${states['[[entity-climate-goal]]'].state}`; }
            ]]]
          state: >
            [[[
              return entity.state;
            ]]]
          state_off: "off"

      - type: custom:mod-card
        card_mod:
          style: |
            ha-card {
              {% if (is_state('climate.id3_electric_climatisation','off')) %}  
              background: var(--ha-card-background-climate-control);
              {% else %}
              background: var(--ha-card-color-name-on);
              {% endif %}
              border-radius: 180px !important;
              padding: 4px;              
              --horizontal-stack-card-margin: 0px;
            }
        card:
          type: horizontal-stack
          cards:
            - type: "custom:button-card"
              aspect_ratio: 1/1
              icon: mdi:minus
              color: var(--el-text-color-light)
              styles:
                card:
                  - background: var(--ha-card-background-es-static)
                  - border-radius: 50%
              tap_action:
                action: call-service
                service: input_number.decrement
                data:
                  entity_id: "[[entity-climate-goal]]"
            - type: "custom:button-card"
              aspect_ratio: 1/1
              icon: mdi:play
              color: var(--el-es-static-text)
              styles:
                card:
                  - background: transparent
              tap_action:
                action: call-service
                service: climate.set_temperature
                service_data:
                  entity_id: "[[entity-climate]]"
                  temperature: >
                    [[[
                      return parseFloat(states['[[entity-climate-goal]]'].state);
                    ]]]
            - type: "custom:button-card"
              aspect_ratio: 1/1
              icon: mdi:plus
              color: var(--el-text-color-light)
              styles:
                card:
                  - background: var(--ha-card-background-es-static)
                  - border-radius: 50%
              tap_action:
                action: call-service
                service: input_number.increment
                data:
                  entity_id: "[[entity-climate-goal]]"
    default: null
    card_mod:
      style: |
        ha-card {
          {% if (is_state('climate.id3_electric_climatisation','off')) %}  
          background: var(--ha-card-background-es-off);
          {% else %}
          background: var(--ha-card-background-es-on);
          {% endif %}
          height: 165px;
          width: 165px;
        }
        ha-card > div {
          display: inline-flex;
          flex-direction: column;
          height: calc(100% - 20px);
          justify-content: space-between;
          padding: 10px;
          width: calc(100% - 20px);
        }

#---------------------#
# Pets
#---------------------#

pet-litter:
  default: null
  card:
    type: custom:mod-card
    card_mod:
      style: |
        ha-card {
          background: var(--ha-card-background-es-static);
          background-position: bottom;
          background-image: url('/local/images/pets/litter-1.png');
          background-size: 125%;
          border-radius: var(--ha-card-border-radius);
          height: 133px;
          padding: 4px 8px;
        }
    card:
      type: "custom:layout-card"
      layout_type: "custom:grid-layout"
      layout:
        grid-template-columns: 1fr
        grid-template-rows: 1fr min-content
        grid-template-areas: |
          "sensor-top" "sensors-pill"
        margin: 0px
        padding: 0px
        height: 100%
      cards:
        - type: markdown
          view_layout:
            grid-area: sensor-top
          content: |
            {% set days = states.sensor.days_since_cat_litter_change.state %}

            <b>{{ days }} dias</b>
            desde a Ãºltima revisÃ£o
          card_mod:
            style:
              .: |
                ha-card.type-markdown {
                  background: transparent;
                }
                ha-markdown {
                  color: var(--white1);
                  font-size: 10px;
                  line-height: 1;
                  padding: 8px 14px 0px !important;
                }
              "ha-markdown $ ha-markdown-element": |
                p {
                  margin: 0;
                }
                b {
                  color: var(--white1);
                  font-size: 28px;
                  line-height: 1;
                }

pet-litter-dashboard:
  default: null
  card:
    type: custom:mod-card
    card_mod:
      style: |
        ha-card {
          background: var(--ha-card-background-es-static);
          border-radius: var(--ha-card-border-radius);
          height: 110px;
          padding: 4px 8px;
          position: relative;
          overflow: hidden;
        }
        ha-card::before {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-position: bottom;
          background-image: url('/local/images/pets/litter-1.png');
          background-size: 125%;
          z-index: 0;
          {% set days = states.sensor.days_since_cat_litter_change.state | int(0) %}
          {% if days < 3 %}
          filter: grayscale(100%) brightness(0.6);
          {% endif %}
        }
        ha-card > * {
          position: relative;
          z-index: 1;
        }
    card:
      type: markdown
      content: |
        {% set days = states.sensor.days_since_cat_litter_change.state %}

        <b>{{ days }} dias</b>
        Ãºltima troca
      card_mod:
        style:
          .: |
            ha-card.type-markdown {
              background: transparent;
            }
            ha-markdown {
              color: var(--white1);
              font-size: 12px;
              line-height: 1;
              padding: 8px 14px 0px !important;
            }
          "ha-markdown $ ha-markdown-element": |
            p {
              margin: 0;
            }
            b {
              color: var(--white1);
              font-size: 28px;
              line-height: 1;
            }

pet-fountain:
  default: null
  card:
    type: custom:mod-card
    card_mod:
      style: |
        ha-card {
          background: var(--ha-card-background-es-static);
          background-position: center;
          background-position-y: 85%;
          background-image: url('/local/images/pets/fountain.png');
          background-size: cover;
          border-radius: var(--ha-card-border-radius);
          height: 160px;
          padding: 4px 8px;
        }

    card:
      type: "custom:layout-card"
      layout_type: "custom:grid-layout"
      layout:
        grid-template-columns: 1fr 1fr min-content
        grid-template-rows: 1fr min-content
        grid-template-areas: |
          "sensor-top sensor-top ." "sensors-pill sensors-pill sensors-pill"
        margin: 0px
        padding: 0px
        height: 100%
      cards:
        - type: "custom:button-card"
          custom_fields: !include ../icons/glow.yaml
          view_layout:
            justify-self: flex-end
          entity: switch.petlibro_plwf105_pump
          show_name: off
          show_icon: off
          show_state: off
          styles:
            card:
              - background: transparent
              - height: 20px
              - width: 20px
              - position: relative
            custom_fields:
              glow:
                - height: 20px
                - position: absolute
                - top: 0
                - right: 0
                - width: 20px
          state:
            - value: "off"
              styles:
                custom_fields:
                  glow:
                    - display: none
        - type: markdown
          view_layout:
            grid-area: sensor-top
          content: |
            {% set sensor_value = states.sensor.petlibro_plwf105_last_drink_amount_ml.state | float | round(0) %}
            {% set timestamp = states.sensor.petlibro_plwf105_last_drink_amount_ml.last_changed %}

            <b>{{ sensor_value }} ml</b>
            Ãs {{ (as_timestamp(timestamp)) | timestamp_custom("%-Hh%M", true) }}
          card_mod:
            style:
              .: |
                ha-card.type-markdown {
                  background: transparent;
                  overflow: visible;
                }
                ha-markdown {
                  color: var(--white1);
                  font-size: 10px;
                  line-height: 1;
                  padding: 10px 14px !important;
                }
              "ha-markdown $ ha-markdown-element": |
                b {
                  color: var(--white1);
                  font-size: 28px;
                  line-height: 1;
                }
        - type: "custom:layout-card"
          layout_type: "custom:grid-layout"
          layout:
            grid-template-columns: min-content min-content min-content
            grid-template-rows: 1fr
          view_layout:
            grid-area: sensors-pill
          cards:
            - template: sensor-pill
              type: "custom:decluttering-card"
              variables:
                - entity: sensor.petlibro_plwf105_water_level
                - icon: mdi:water-thermometer
                - numeric_precision: 0
                - color-state-on: --ha-card-color-name-on
                - show-overflow: true
            - template: sensor-pill
              type: "custom:decluttering-card"
              variables:
                - entity: sensor.pet_foutain_tank_status
                - icon: mdi:connection
                - color-state-on: --ha-card-color-name-on
                - show-overflow: true
            - template: sensor-pill
              type: "custom:decluttering-card"
              variables:
                - entity: sensor.days_since_last_tank_disconnection
                - icon: mdi:repeat-variant
                - numeric_precision: 0
                - color-state-on: --ha-card-color-name-on
                - show-overflow: true

pet-fountain-dashboard:
  default: null
  card:
    type: custom:mod-card
    card_mod:
      style: |
        ha-card {
          background: var(--ha-card-background-es-static);
          border-radius: var(--ha-card-border-radius);
          height: 110px;
          padding: 4px 8px;
          position: relative;
          overflow: hidden;
        }
        ha-card::before {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-position: center;
          background-position-y: 85%;
          background-image: url('/local/images/pets/fountain.png');
          background-size: cover;
          z-index: 0;
          {% set level = states('sensor.petlibro_plwf105_water_level') | int(0) %}
          {% if level > 15 %}
          filter: grayscale(100%) brightness(0.6);
          {% endif %}
        }
        ha-card > * {
          position: relative;
          z-index: 1;
        }
    card:
      type: markdown
      content: |
        {% set level = states('sensor.petlibro_plwf105_water_level') | int(0) %}

        <b>{{ level }}%</b>
        nÃ­vel de Ã¡gua
      card_mod:
        style:
          .: |
            ha-card.type-markdown {
              background: transparent;
            }
            ha-markdown {
              color: var(--white1);
              font-size: 12px;
              line-height: 1;
              padding: 8px 14px 0px !important;
            }
          "ha-markdown $ ha-markdown-element": |
            p {
              margin: 0;
            }
            b {
              color: var(--white1);
              font-size: 28px;
              line-height: 1;
            }

pet-feeder:
  default: null
  card:
    type: custom:mod-card
    card_mod:
      style: |
        ha-card {
          background: var(--ha-card-background-es-static);
          background-position: center;
          background-position-y: 85%;
          background-image: url('/local/images/pets/feeder.png');
          background-size: cover;
          border-radius: var(--ha-card-border-radius);
          height: 200px;
          padding: 4px 8px;
        }
    card:
      type: "custom:layout-card"
      layout_type: "custom:grid-layout"
      layout:
        grid-template-columns: 1fr 1fr 1fr
        grid-template-rows: 1fr min-content
        grid-template-areas: |
          "sensor-top sensor-top schedule" "sensors-pill sensors-pill sensors-pill"
        margin: 0px
        padding: 0px
        height: 100%
      cards:
        - type: markdown
          view_layout:
            grid-area: sensor-top
          content: |
            {% set sensor_value = states.sensor.aqara_pet_feeder_weight_per_day.state | float | round(0) %}

            <b>{{ sensor_value }} g</b>
            Hoje
          card_mod:
            style:
              .: |
                ha-card.type-markdown {
                  background: transparent;
                }
                ha-markdown {
                  color: var(--white1);
                  font-size: 10px;
                  line-height: 1;
                  padding: 10px 14px !important;
                }
              "ha-markdown $ ha-markdown-element": |
                b {
                  color: var(--white1);
                  font-size: 28px;
                  line-height: 1;
                }
        - type: markdown
          view_layout:
            grid-area: schedule
          content: |
            {% set feeding_schedule = [
              {'days': 'everyday', 'hour': 8, 'minute': 30, 'size': 2},
              {'days': 'everyday', 'hour': 13, 'minute': 0, 'size': 1},
              {'days': 'everyday', 'hour': 18, 'minute': 0, 'size': 2},
              {'days': 'everyday', 'hour': 22, 'minute': 0, 'size': 2}
            ] %}
            {% set current_day = now().strftime('%a').lower() %}
            {% set current_weekday = now().weekday() %}
            {% set current_time_minutes = now().hour * 60 + now().minute %}
            {% set day_mapping = {
              'mon': 0, 'tue': 1, 'wed': 2, 'thu': 3, 'fri': 4, 'sat': 5, 'sun': 6
            } %}

            <h5>Schedule</h5>
            {% for schedule in feeding_schedule %}
              {% set show_schedule = false %}
              
              {# Check if schedule applies to today #}
              {% if schedule.days == 'everyday' %}
                {% set show_schedule = true %}
              {% elif schedule.days == 'workdays' and current_weekday < 5 %}
                {% set show_schedule = true %}
              {% elif schedule.days == 'weekend' and current_weekday >= 5 %}
                {% set show_schedule = true %}
              {% elif schedule.days in ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'] and day_mapping[schedule.days] == current_weekday %}
                {% set show_schedule = true %}
              {% elif schedule.days == 'mon-wed-fri-sun' and current_weekday in [0, 2, 4, 6] %}
                {% set show_schedule = true %}
              {% elif schedule.days == 'tue-thu-sat' and current_weekday in [1, 3, 5] %}
                {% set show_schedule = true %}
              {% endif %}

              {% if show_schedule %}
                {% set schedule_time_minutes = schedule.hour * 60 + schedule.minute %}
                {% set is_future = schedule_time_minutes > current_time_minutes %}
              <{% if is_future %}div{% else %}p{% endif %}>{{ schedule.hour }}h{{ "%02d"|format(schedule.minute) }}  {% for i in range(schedule.size) %}<ha-icon icon="mdi:fish"></ha-icon>{% endfor %}<{% if is_future %}/div{% else %}/p{% endif %}>
              {% else %}
              <p>No feed</p>
              {% endif %}
            {% endfor %}
          card_mod:
            style:
              .: |
                ha-card.type-markdown {
                  background: transparent;
                }
                ha-markdown {
                  color: var(--ha-card-background-es-off);
                  display: flex;
                  padding: 10px 12px 0 12px !important;
                  text-align: right;
                }
              "ha-markdown $ ha-markdown-element": |
                h5 {
                  margin: 0 0 4px 0;
                }
                div, p{
                  border-radius: 16px;
                  font-size: 10px;
                  font-weight: bold;
                  line-height: 1;
                  margin: 0 0 4px 0;
                  padding: 4px 8px;
                  --mdc-icon-size: 10px;  
                }
                p {
                  border: 1.5px solid;
                  border-color: var(--ha-card-background-es-off);
                }
                div {
                  color: var(--ha-card-background-es-off);
                }
                div {
                  background: var(--ha-card-background-es-on);
                  color: var(--ha-card-color-name-on);
                }
        - type: "custom:layout-card"
          layout_type: "custom:grid-layout"
          layout:
            grid-template-columns: min-content min-content min-content
            grid-template-rows: 1fr
          view_layout:
            grid-area: sensors-pill
          cards:
            - template: sensor-pill
              type: "custom:decluttering-card"
              variables:
                - entity: sensor.pet_feeder_status
                - icon: mdi:connection
                - color-state-on: --ha-card-color-name-on
                - show-overflow: true
            - template: sensor-pill
              type: "custom:decluttering-card"
              variables:
                - entity: select.aqara_pet_feeder_mode
                - icon: mdi:repeat-variant
                - numeric_precision: 0
                - color-state-on: --ha-card-color-name-on
                - show-overflow: true

#---------------------#
# Cars
#---------------------#

car-state:
  default: null
  card:
    type: custom:vertical-stack-in-card
    card_mod:
      style: |
        ha-card.type-custom-vertical-stack-in-card {
          background: transparent;
        }
        layout-card {
          background: var(--ha-card-background-es-static);
          border-radius: var(--ha-card-border-radius);
          display: block;
          padding-top: 30px;
        }
    cards:
      - type: picture
        image: /local/images/cars/side.png
        card_mod:
          style: |
            ha-card.type-picture {
              background: transparent;
              min-height: 160px;
            }
      - type: markdown
        content: |
          {% set ts_1 = as_timestamp(states('sensor.id3_last_data_refresh'), 0) %}
          {% set ts_2 = as_timestamp(states('sensor.id3_last_connected'), 0) %}
          {% set latest = max(ts_1, ts_2) %}
          {% set diff = as_timestamp(now()) - latest %}
          {% set hours = (diff / 3600) | int %}
          {% set minutes = ((diff % 3600) / 60) | int %}
          {% if hours > 0 %}
            Atualizado Ã  {{ hours }}h e {{ minutes }}min
          {% else %}
            Atualizado Ã  {{ minutes }}min
          {% endif %}
        card_mod:
          style: |
            ha-card.type-markdown {
              background: transparent;
              margin-bottom: -45px;
              overflow: visible;
            }
            ha-markdown {
              color: var(--el-text-color-light);
              font-size: 10px;
              margin-top: -35px;
              padding-bottom: 0px !important;
              padding-top: 0px !important;
              text-align: center !important;
            }

      - type: custom:state-switch
        entity: binary_sensor.id3_doors_locked
        default: default
        states:
          "on":
            type: markdown
            content: |
              <ha-icon icon="mdi:lock-open-alert-outline"></ha-icon> Aberto
            card_mod:
              style: |
                ha-card.type-markdown {
                  background: transparent;
                  display: flex;
                  justify-content: center;
                  margin-bottom: -45px;
                  overflow: visible;
                  width: 100%;
                  --mdc-icon-size: 12px;
                }
                ha-markdown {
                  background-color: var(--ha-card-background-es-off);
                  border-radius: 40px;
                  color: var(--el-text-color);
                  font-size: 12px;
                  font-weight: bold;
                  height: 18px;
                  margin-top: -45px;
                  padding-bottom: 10px !important;
                  padding-left: 16px !important;
                  padding-top: 10px !important;
                  padding-right: 16px !important;
                }

      - type: custom:layout-card
        layout_type: custom:horizontal-layout
        layout:
          column_widths: min-content 1fr
          max_width: 350
          width: 150
        cards:
          - type: "custom:button-card"
            entity: "[[entity_range]]"
            show_name: false
            show_icon: false
            show_state: false
            tap_action:
              action: none
            styles:
              card:
                - background: transparent
                - border-radius: 0
                - height: 46px
                - padding: 0
              custom_fields:
                number:
                  - align-self: end
                  - color: var(--el-text-color)
                  - font-size: 32px
                  - font-weight: bold
                  - line-height: 26px
                  - margin-right: 4px
                label:
                  - align-self: end
                  - color: var(--el-text-color-light)
                  - font-size: 12px
                  - font-weight: bold
                  - margin-right: 8px
              grid:
                - grid-template-areas: '"number label"'
                - grid-template-columns: min-content min-content
                - text-align: left
            template: sensors-car-range

          - type: vertical-stack
            view_layout:
              column: 2
            cards:
              - type: "custom:bar-card"
                entities:
                  - entity: "[[entity-battery]]"
                target: 20
                height: 35px
                icon: mdi:lightning-bolt
                positions:
                  icon: "inside"
                  indicator: "off"
                  minmax: "off"
                  name: "off"
                  value: inside
                card_mod:
                  style: |-
                    ha-card.type-custom-bar-card {
                      background: transparent;
                    }
                    .card-content {
                      padding-bottom: 0px;
                      padding-left: 5px;
                      padding-right: 4px;
                    }
                    bar-card-card {
                      --bar-card-border-radius: 6px;
                      --mdc-icon-size: 18px;
                    }
                    bar-card-backgroundbar {
                      background: var(--ha-card-bar-background);
                      filter: none;
                      opacity: 1;
                    }
                    bar-card-iconbar {
                      color: white;
                    }
                    bar-card-currentbar {
                      --bar-card-color: rgb(93, 167, 98);
                    }
                    .value-direction-right {
                      color: var(--el-text-color);
                      font-weight: bold;
                    }
              - type: markdown
                content: |
                  {% if not(is_state('sensor.my_id_remaining_charging_time', '0')) %}
                  {% set ct = states('sensor.my_id_remaining_charging_time') | int %}
                    {% if ct > 60 %}{{ ct // 60 }}:{{ '{:0>2d}'.format(ct%60) }}min{% else %}{{ct}}min{% endif %} restantes
                  {% endif %}
                card_mod:
                  style: |
                    ha-card.type-markdown {
                      background: transparent;
                    }
                    ha-markdown {
                      color: var(--el-text-color-light);
                      font-size: 11px;
                      font-weight: bold;
                      margin-top: -6px;
                      padding-bottom: 0px !important;
                      padding-top: 0px !important;
                      text-align: center !important;
                    }

car-odometer:
  default: null
  card:
    type: "custom:button-card"
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: true
    tap_action:
      action: none
    styles: !include ../styles/style-card-car-pill.yaml
    template: "[[template]]"

car-tires:
  card:
    type: "custom:button-card"
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: false
    tap_action:
      action: none
    styles: !include ../styles/style-card-car-info.yaml
    template: "[[template]]"
  default: null

car-stats:
  card:
    type: "custom:button-card"
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: false
    tap_action:
      action: none
    state: !include ../states/state-car-charge.yaml
    styles: !include ../styles/style-card-car-info.yaml
    template: "[[template]]"
  default: null

car-charge-stats:
  card:
    type: "custom:button-card"
    entity: "[[entity]]"
    name: "[[name]]"
    show_icon: false
    show_state: false
    tap_action:
      action: none
    state: !include ../states/state-car-charge.yaml
    styles: !include ../styles/style-card-car-graph.yaml
    custom_fields: !include ../graphs/car-charge-stats.yaml
  default: null

car-charge-option:
  card:
    type: "custom:button-card"
    entity: "[[entity]]"
    name: "[[type]]"
    icon: "[[icon]]"
    show_icon: true
    show_state: false
    show_name: false
    tap_action:
      action: none
    styles: !include ../styles/style-card-car-charge.yaml
    template: "[[template]]"
    variables:
      rate: "[[rate]]"
  default: null
